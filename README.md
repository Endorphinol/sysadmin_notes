# Проектная работа 1. Настройка файлового и прокси сервера.

## Задание №1. Настройка файлового сервера и монтирование директории. Первая виртуальная машина.

1. Создал пользователя командой: _**sudo useradd -m smbuser.**_
2. Установил пакет Samba для работы с SMB протоколом: _**sudo apt install samba.**_
3. В директории _**/etc/samba/**_ создал резервную копию файла (в случае ошибки): _**cp smb.conf rsmb.conf.**_
4. Поместил в конец файла конфигурации, следующую запись:

```
[share] – имя ресурса.
[path] – путь к директорий, к которой будет предоставлен доступ.
[public] – предоставляет доступ на чтения авторизованным и неавторизованным пользователям.
[read only] – выполнение по заданию, предоставляет права только на чтение.
```

5. Разместил в разделе **[global]** информацию об аутентификации: _**security = user**_ – для обеспечения входа по имени пользователя и паролю.
6. Разместил в разделе **[share]** информацию о разрешенных пользователях: _**valid users = созданный аккаунт**_.
7. Создал пароль для нового пользователя smduser с помощью команды: _**smbpasswd -a smbuser**_.

## Задание №1.1. Настройка файлового сервера и монтирование директории. Вторая виртуальная машина.

```
1.	Установил пакет для работы с протоколом SMB с помощью команды: sudo apt install cifs-utils.
2.	Установил пакет для автоматического монтирования с помощью команды: sudo apt install autofs.
3.	В директории /etc/ создал резервную копию файла (в случае ошибки): cp auto.master rauto.master.
4.	В директории в файле auto.master добавил запись:
5.	В директории /etc/ создал файл auto.myserver с настройками:
6.	Запустил вторую виртуальную машину на порте 8000 по умолчанию: python3 -m http.server --directory /media/share.
7.	Запустил третью виртуальную машину на порте 8001 по умолчанию: python3 -m http.server --directory /media/share.
```

## Задание №2. Настройка прокси-сервера.

```
1. Создал третью виртуальную машину.
2. Установил пакеты: sudo apt install cifs-utils, autofs.
3. Отредактировал файл auto.master как на второй машине, создал файл auto.myserver с аналогичным содержимым как на второй машине.
4. Перешел на первую виртуальную машину и скачал nginx: sudo apt install nginx.
5. Перешел в директорию /etc/nginx и создал резервный файл cp nginx.conf rnginx.conf.
6. Настроил файл nginx.conf.
```

## Дополнительное задание:

```
Сделаны запросы с помощью curl.
```

# Проектная работа № 2. Настройка мониторинга.

## Шаг 1. Установка Zabbix-сервера.

1. **Обновляем репозитории пакетов на хосте.**
2. **Устанавливаем пакет с базами данных mysql-server.**
3. **Проверяем запускаем демона sudo systemctl start mysql.**
4. **Уставливаем пакет с репозиторием Zabbix zabbix-release через wget.**
5. **Устанавливаем загруженный пакет в систему с помощью sudo dpkg -i zabbix-release_6.4-1 ubuntu22.04_all.deb (локальная установка пакетов).**
6. **После установки репозитория актулизируем список пакетов для установки (с целью актуализации данных. Синхронизируем локальное хранилище).**
7. **Устаналиваем дополнительно необходимые пакеты sudo apt install zabbix-server-mysql zabbix-frontend-php zabbix-nginx-conf zabbix-sql-scripts zabbix-agent.**

---

```
8. Настраиваем БД MySQL с помощью установленного пакета mysql (Здесь стоит остановится и рассмотреть процедуру детальнее).

8.1 Подключаемся к MySQL под root.
sudo mysql -uroot -p
-uroot — подключается от имени пользователя root.
-p — запрашивает пароль (после нажатия Enter нужно ввести пароль для root).

8.2 Создание базы данных zabbix.
CREATE DATABASE zabbix CHARACTER SET utf8mb4 COLLATE utf8mb4_bin;
CREATE DATABASE zabbix — создаёт новую базу данных с именем zabbix.
CHARACTER SET utf8mb4 — задаёт кодировку,
COLLATE utf8mb4_bin — устанавливает бинарное сравнение символов.

8.3 Создание пользователя zabbix.
CREATE USER 'zabbix'@'localhost' IDENTIFIED BY 'your_password';
CREATE USER — создаёт нового пользователя.
'zabbix'@'localhost' — имя пользователя (zabbix) и хост, с которого разрешено подключение (localhost = только с этого сервера).
IDENTIFIED BY 'your_password' — пароль для пользователя (задаем самостоятельно).

8.4 Назначение прав пользователю zabbix.
GRANT ALL PRIVILEGES ON zabbix.* TO 'zabbix'@'localhost';
GRANT ALL PRIVILEGES — даёт пользователю все права.
ON zabbix.* — применяется ко всем таблицам (*) в zabbix.
TO 'zabbix'@'localhost' — назначает права пользователю zabbix.

8.5 Включение функции создания триггеров.
SET GLOBAL log_bin_trust_function_creators = 1;
SET GLOBAL — изменяет глобальную настройку MySQL.
log_bin_trust_function_creators = 1 — разрешает создание триггеров и хранимых процедур без проверки привилегий.

8.6 Выход из MySQL.
QUIT;
```

9. **Извлекаем схему БД Zabbix из архива:**  
   sudo zcat /usr/share/zabbix-sql-scripts/mysql/server.sql.gz | mysql --default-character-set=utf8mb4 -uzabbix -p zabbix и передаем в MySQL, а MySQL импортирует схему в БД.

10. **Подключаемся к MySQL под root:**  
    -uroot — подключается от имени пользователя root. -p — запрашивает пароль (после нажатия Enter нужно ввести пароль для root).
    10.1 Меняем значение переменной конфигурации SET GLOBAL log_bin_trust_function_creators = 0 для огранчения создания функции пользователям без привилегии.

```
11. Вносим изменения в файлы конфигурации /etc/zabbix/zabbix_server.conf.
11.1 Предварительно создаем копию файла для избежания ошибок (sudo cp zabbix_server.conf zzabbix_server.conf).
11.2 Ищем строку в файле через VIM с помощью / - далее в строке DBPassword устаналиваем пароль (установленный ранее).
```

```
12. Вносим изменения в фалйы конфигурации /etc/zabbix/nginx.conf.
12.1 Предварительно создаем копию файла для избежания ошибок. sudo cp nginx.conf znginx.conf.
12.2 Раскоментируем строки listen 8080;
# server_name your_ip_address.
12.3 Перезапускаем демонов sudo systemctl restart zabbix-server zabbix-agent nginx php8.1-fpm.
```

13. **Добавим в автозапуск служб Zabbix сервер и агента sudo systemctl enable zabbix-server zabbix-agent php8.1-fpm.**

```
14. Меняем путь nginx на новую директорию для веб-интерфейса Zabbix.
14.2 Меняем путь с root /var/www/html на root /usr/share/zabbix.
14.3 Перезапускаем nginx sudo systemctl restart nginx.
```

```
15. Открываем порты для Firewall (так мы разрешим доступ к портам, с которыми работает Zabbix и Nginx).
15.1 Открываем порты:
sudo ufw allow 10050/tcp
sudo ufw allow 10051/tcp
sudo ufw allow 80/tcp
15.2 Перезагружаем правила: sudo ufw reload.
```

```
16. Выполняем русификацию Zabbix-сервера:
16.1 Необходимо раскоментировать строку в файле /etc/locale.gen, предварительно делаем копию файла sudo cp locale.gen zlocale.gen. Далее, sudo sed -i  "s/# ru_RU.UTF-8 UTF-8/ru_RU.UTF-8 UTF-8/g" /etc/locale.gen.
16.2 Необходимо сгенерировать файлы локализации sudo locale-gen.
16.3 Необходимо перезапустить демонов sudo systemctl restart zabbix-server nginx php8.1-fpm.
```

```
17. Выполняем первичный вход в Zabbix:
17.1 В разделе Default language выбираем параметры по умолчанию English - Next step.
17.2 В разделе Check of pre-requisites переходим к следующему шагу - Next step.
17.3 В разделе Configure DB connection в поле password устанавливаем пароль, который ранее устаналивали пользователю с именем zabbix в MySQL и переходим далее - Next step.
17.4 В разделе Settings выбираем имя для нашего Zabbix-сервера (имя можно указывать любой, мной было указано Zabbix Main Server) - Next step.
17.5 В разделе Pre-installation summary мы наблюдаем итоговую настройку и нажимаем - Next step.
17.6 Первичный вход осуществляется под именем Admin и пароль Zabbix.
```

18. **Переходим в веб-версию Zabbix Administration → General → GUI — и меняем язык по умолчанию (Default language) на Русский (ru_RU).**

```
19. Cоздание нового пользователя:
19.1 Переходим в раздел "Пользователи" и нажимаем "Создать пользователя".
19.2 Указываем имя пользователя.
19.3 Указываем имя и фамилию.
19.4 Добавляем в группу Zabbix Administrations.
19.5 Задаем пароль для пользователя.
19.6 В разделе "Права доступа" назначаем роль "Admin role".
19.7 Заходим под пользователем Daniel и заданным паролем.
```

## Задание №1. Мониторинг сайта yandex.ru.

1. В разделе "Сбор данных" - "Узлы сети" - "Веб" создаем веб-сценарии для мониторинга доступности, код и время ответа, скорости загрузки
2. Настраиваем сценарий с одним шагом: «Открыть сайт», а URL задаем https://yandex.ru. (не забывать на каждый сценарии и триггер указывать теги для удобного поиска).
3. Создаем триггер с именем «Сайт yandex.ru недоступен», который будет реагировать в случае недоступности сайта. В разделе "Триггеры" (для проверки доступности веб-сервера использовать элемент данных Failed step of scenario.)
4. Проблема будет возникать при нарушении связи между Zabbix-сервером и https://yandex.ru, а приходить в норму, когда связь восстанавливается. В разделе «Мониторинг» → «Проблемы» должна появляться и исчезать проблема.

```
Сбой для проверки этого задания можно устроить так:
    sudo ufw allow 22/tcp — добавляем разрешающее правило для подключения по ssh
    sudo ufw allow 8080/tcp — добавляем разрешающее правило для порта, на котором работает веб-интерфейс zabbix-сервера
    sudo ufw deny out 443/tcp — блокируем исходящие подключения на порт 443 (https)
    sudo ufw show added — посмотреть добавленные правила
    sudo ufw enable — включаем сетевой экран
```

```
А вот так — вернуть связь в нормальное состояние:
    sudo ufw disable — отключаем сетевой экран.
```

## Задание №2. Проверка доступности сервера yandex.ru.

1. Нужно проверить "Доступность всего сервера по сети". Для этого в Zabbix используется элемент данных с типом «Простая проверка» и ключ icmpping.
2. Создаем для узла сети Zabbix server элемент данных «Яндекс сервер» с типом «Простая проверка» и ключом icmpping (для ключа icmpping достаточно указать только один параметр — target).
3. Создаём триггер с возможностью ручного закрытия для этого элемента — он должен срабатывать, если ping не проходит. Называем его «Сервер Яндекс недоступен».
4. Эмитируем сбой и проверяем, что в интерфейсе Zabbix в разделе «Мониторинг» → «Проблема» появляется запись при пропадании связи с сервером (чтобы устроить сбой для этого задания, добавьте в файл /etc/hosts строку 172.0.0.1 yandex.ru. Для восстановления нормальной работы закомментируйте её). Возникнет проблема и сайтом одновременно.

## Задание №3. Установка зависимостей проверок.
### Иногда одна проблема влечёт за собой цепочку событий, и в этом задании мы свяжем их.
1. Настраиваем триггер «Сайт yandex.ru недоступен» зависимым от «Сервер Яндекс недоступен».
2. Эмитируем сбой доступа для сервера: раскомментируем строку в файле /etc/hosts из предыдущего задания.
3. Эмитируем сбой доступности сайта из первого задания — ufw enable (появляется только проблема «Сайт yandex.ru недоступен», и восстановите доступность сайта — ufw disable).
